{"ast":null,"code":"import { useRoutePreloader, useRouter } from \"../../router/index.js\";\nimport { motion } from \"framer-motion\";\nimport * as React from \"react\";\nimport { useRef } from \"react\";\nimport { Animatable } from \"../../animation/Animatable/Animatable.js\";\nimport { cx } from \"../../modules/cx.js\";\nimport { parseFramerPageLink, replaceFramerPageLinks, useLinkMatchesRoute } from \"../../modules/framerPageLink.js\";\nimport { useIsOnFramerCanvas } from \"../../modules/useIsOnFramerCanvas.js\";\nimport { collectTextShadowsForProps } from \"../style/shadow.js\";\nimport { calculateRect, ParentSizeState, useParentSize } from \"../types/NewConstraints.js\";\nimport { RenderTarget } from \"../types/RenderEnvironment.js\";\nimport { collectFiltersFromProps } from \"../utils/filtersForNode.js\";\nimport { injectComponentCSSRules } from \"../utils/injectComponentCSSRules.js\";\nimport { forceLayerBackingWithCSSProperties } from \"../utils/setLayerBacked.js\";\nimport { transformTemplate } from \"../utils/transformTemplate.js\";\nimport { useLayoutId } from \"../utils/useLayoutId.js\";\nimport { useMeasureLayout } from \"../utils/useMeasureLayout.js\";\nimport { ComponentContainerContext } from \"./ComponentContainerContext.js\";\nimport { findAnchorElementWithin } from \"./Text.js\";\n/**\n * @internal\n * Don't change this value as it's used in generated components as well.\n */\n\nexport const richTextPlaceholder = \"{{ text-placeholder }}\";\n/**\n * @internal\n */\n\nexport const RichText = React.forwardRef(function Text(props, forwardedRef) {\n  const {\n    id,\n    name,\n    html = \"\",\n    text,\n    width,\n    height,\n    left,\n    right,\n    top,\n    bottom,\n    center,\n    className,\n    visible = true,\n    opacity,\n    rotation = 0,\n    verticalAlignment = \"top\",\n    isEditable = false,\n    willChangeTransform,\n    environment = RenderTarget.current,\n    withExternalLayout = false,\n    positionSticky,\n    positionStickyTop,\n    positionStickyRight,\n    positionStickyBottom,\n    positionStickyLeft,\n    __htmlStructure,\n    __fromCanvasComponent,\n    _forwardedOverrideId,\n    _forwardedOverrides,\n    _usesDOMRect,\n    ...rest\n  } = props;\n  const parentSize = useParentSize();\n  const layoutId = useLayoutId(props);\n  const fallbackLayoutRef = useRef(null);\n  const layoutRef = forwardedRef ?? fallbackLayoutRef;\n  const {\n    navigate,\n    getRoute,\n    currentRouteId\n  } = useRouter();\n  useRoutePreloader(props.preload ?? []);\n  useMeasureLayout(props, layoutRef);\n  const inCodeComponent = React.useContext(ComponentContainerContext);\n  const matchesCurrentRoute = useLinkMatchesRoute(props.__link);\n  const isOnCanvas = useIsOnFramerCanvas();\n  let innerHTML = html;\n  let textContent = text; // Replace HTML with text override or variable\n\n  const forwardedOverrideId = _forwardedOverrideId ?? id;\n\n  if (forwardedOverrideId && _forwardedOverrides) {\n    const text = _forwardedOverrides[forwardedOverrideId];\n\n    if (typeof text === \"string\") {\n      textContent = text;\n    }\n  } // The placeholder is inserted in collectRichText.ts\n\n\n  if (textContent && __htmlStructure) {\n    innerHTML = __htmlStructure.replace(richTextPlaceholder, textContent);\n  } // Parse the ProseMirror HTML to replace framer page links in the `data:framer/page-link,`\n  // format with the correct paths their target corresponds to.\n  // This needs to happen whenever the HTML string changes, since smart\n  // components can update the ProseMirror HTML in variants by updating this prop value.\n\n\n  innerHTML = React.useMemo(() => {\n    if (isOnCanvas || !getRoute || !currentRouteId) return innerHTML;\n    return replaceFramerPageLinks(innerHTML, getRoute, currentRouteId);\n  }, [innerHTML, getRoute, isOnCanvas, currentRouteId]);\n  React.useEffect(() => {\n    const container = layoutRef.current;\n    if (container === null) return;\n\n    function interceptPageLinks(event) {\n      const anchorElement = findAnchorElementWithin(event.target, layoutRef); // Don't prevent cmd + click, allowing users to open in new tab.\n\n      if (event.metaKey || !navigate || !anchorElement) return; // Page links written to the ProseMirror HTML in the `data:framer/page-link,`\n      // format should have been parsed, and replaced with the correct paths.\n      // If that has happened, we can access the route id and transition properties\n      // as data attributes, finally performing a navigation.\n\n      const pageLink = anchorElement.getAttribute(\"data-framer-page-link-target\"\n      /* Page */\n      );\n      const elementId = anchorElement.getAttribute(\"data-framer-page-link-element\"\n      /* Element */\n      );\n\n      if (pageLink) {\n        event.preventDefault();\n        return navigate(pageLink, elementId ?? undefined);\n      } // If for some reason the page links in the ProseMirror HTML have not been\n      // parsed, try to still perform a navigation by parsing the page\n      // link in the href.\n\n\n      const href = anchorElement.getAttribute(\"href\");\n\n      if (href) {\n        const link = parseFramerPageLink(href);\n        if (!link || !link.target) return;\n        event.preventDefault();\n        return navigate(link.target, link.element ?? undefined);\n      }\n    }\n\n    container.addEventListener(\"click\", interceptPageLinks);\n    return () => {\n      container.removeEventListener(\"click\", interceptPageLinks);\n    };\n  }, [navigate]); // Hooks need to be above this line\n\n  if (!visible) return null;\n  injectComponentCSSRules();\n  const isHidden = isEditable && environment() === RenderTarget.canvas; // Add more styling and support vertical text alignment\n\n  const style = {\n    outline: \"none\",\n    display: \"flex\",\n    flexDirection: \"column\",\n    justifyContent: convertVerticalAlignment(verticalAlignment),\n    opacity: isHidden ? 0 : opacity,\n    flexShrink: 0\n  };\n  const restrictedRenderTarget = RenderTarget.hasRestrictions();\n  const frame = calculateRect(props, parentSize || ParentSizeState.Unknown, false);\n  const isAutoSized = _usesDOMRect && (width === \"auto\" || height === \"auto\");\n  const hasTransformTemplate = !frame || !restrictedRenderTarget || __fromCanvasComponent || isAutoSized;\n\n  if (!withExternalLayout) {\n    if (frame && restrictedRenderTarget && !isAutoSized) {\n      const rotate = Animatable.getNumber(rotation).toFixed(4);\n      style.transform = `translate(${frame.x}px, ${frame.y}px) rotate(${rotate}deg)`;\n      style.width = frame.width;\n      style.minWidth = frame.width;\n      style.height = frame.height;\n    } else {\n      style.left = left;\n      style.right = right;\n      style.top = top;\n      style.bottom = bottom;\n      style.width = width;\n      style.height = height; // I have no idea why this works as a number but not as a string. This is copied from the Text component.\n\n      style.rotate = rotation;\n    }\n\n    if (positionSticky) {\n      if (!isOnCanvas || inCodeComponent) {\n        style.position = \"sticky\";\n        style.willChange = \"transform\";\n        style.zIndex = 1;\n        style.top = positionStickyTop;\n        style.right = positionStickyRight;\n        style.bottom = positionStickyBottom;\n        style.left = positionStickyLeft;\n      }\n    }\n  }\n\n  collectFiltersFromProps(props, style);\n  collectTextShadowsForProps(props, style);\n\n  if (willChangeTransform) {\n    // We're not using Layer.applyWillChange here, because adding willChange:transform causes clipping issues in export\n    forceLayerBackingWithCSSProperties(style);\n  }\n\n  Object.assign(style, props.style);\n  return React.createElement(motion.div, {\n    id: id,\n    ref: layoutRef,\n    ...rest,\n    style: style,\n    layoutId: layoutId,\n    \"data-framer-name\": name,\n    \"data-framer-component-type\": \"RichText\",\n    \"data-center\": center,\n    className: cx(className, matchesCurrentRoute && \"current\"),\n    transformTemplate: hasTransformTemplate ? transformTemplate(center) : undefined,\n    dangerouslySetInnerHTML: {\n      __html: innerHTML\n    }\n  });\n});\n\nfunction convertVerticalAlignment(verticalAlignment) {\n  switch (verticalAlignment) {\n    case \"top\":\n      return \"flex-start\";\n\n    case \"center\":\n      return \"center\";\n\n    case \"bottom\":\n      return \"flex-end\";\n  }\n}","map":{"version":3,"mappings":"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","names":["useRoutePreloader","useRouter","motion","React","useRef","Animatable","cx","parseFramerPageLink","replaceFramerPageLinks","useLinkMatchesRoute","useIsOnFramerCanvas","collectTextShadowsForProps","calculateRect","ParentSizeState","useParentSize","RenderTarget","collectFiltersFromProps","injectComponentCSSRules","forceLayerBackingWithCSSProperties","transformTemplate","useLayoutId","useMeasureLayout","ComponentContainerContext","findAnchorElementWithin","richTextPlaceholder","RichText","forwardRef","Text","props","forwardedRef","id","name","html","text","width","height","left","right","top","bottom","center","className","visible","opacity","rotation","verticalAlignment","isEditable","willChangeTransform","environment","current","withExternalLayout","positionSticky","positionStickyTop","positionStickyRight","positionStickyBottom","positionStickyLeft","__htmlStructure","__fromCanvasComponent","_forwardedOverrideId","_forwardedOverrides","_usesDOMRect","rest","parentSize","layoutId","fallbackLayoutRef","layoutRef","navigate","getRoute","currentRouteId","preload","inCodeComponent","useContext","matchesCurrentRoute","__link","isOnCanvas","innerHTML","textContent","forwardedOverrideId","replace","useMemo","useEffect","container","interceptPageLinks","event","anchorElement","target","metaKey","pageLink","getAttribute","elementId","preventDefault","undefined","href","link","element","addEventListener","removeEventListener","isHidden","canvas","style","outline","display","flexDirection","justifyContent","convertVerticalAlignment","flexShrink","restrictedRenderTarget","hasRestrictions","frame","Unknown","isAutoSized","hasTransformTemplate","rotate","getNumber","toFixed","transform","x","y","minWidth","position","willChange","zIndex","Object","assign","div","ref","dangerouslySetInnerHTML","__html"],"sources":["../../../src/render/presentation/RichText.tsx"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}