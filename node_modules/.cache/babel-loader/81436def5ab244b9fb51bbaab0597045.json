{"ast":null,"code":"import * as React from \"react\";\nimport { motion } from \"framer-motion\";\nimport { runtime } from \"../../utils/runtimeInjection.js\";\nimport { safeWindow } from \"../../utils/safeWindow.js\";\nimport { imageRenderingForZoom, minZoomForPixelatedImageRendering } from \"../utils/imageRendering.js\";\nimport { useIsomorphicLayoutEffect } from \"../../useIsomorphicLayoutEffect.js\";\nimport { RenderEnvironment, RenderTarget } from \"../types/RenderEnvironment.js\";\nconst wrapperStyle = {\n  position: \"absolute\",\n  pointerEvents: \"none\",\n  userSelect: \"none\",\n  borderRadius: \"inherit\",\n  top: 0,\n  right: 0,\n  bottom: 0,\n  left: 0\n};\n\nfunction cssObjectFit(imageFit) {\n  switch (imageFit) {\n    case \"fit\":\n      return \"contain\";\n\n    case \"stretch\":\n      return \"fill\";\n\n    default:\n      return \"cover\";\n  }\n}\n\nexport function cssImageRendering(image, containerSize) {\n  if (!containerSize) return \"auto\"; // Set appropriate image rendering for the current environment\n\n  const devicePixelRatio = RenderTarget.current() === RenderTarget.canvas ? safeWindow.devicePixelRatio : 1;\n  const minPixelatedZoom = minZoomForPixelatedImageRendering(image, containerSize, devicePixelRatio);\n\n  if (RenderTarget.current() === RenderTarget.canvas) {\n    // On the canvas we want to always keep image-rendering stable during zoom (hence the zoom = 1) the canvas pixelates the images on zooming in with a css rule\n    return imageRenderingForZoom(1, minPixelatedZoom);\n  } else {\n    // In the preview or with export we might require a higer zoom level where images need to get pixelated if their frame is larger then their intrinsic size\n    return imageRenderingForZoom(RenderEnvironment.zoom, minPixelatedZoom);\n  }\n}\n\nfunction getImageStyle(image, containerSize) {\n  return {\n    pointerEvents: \"none\",\n    userSelect: \"none\",\n    display: \"block\",\n    width: \"100%\",\n    height: \"100%\",\n    borderRadius: \"inherit\",\n    objectPosition: \"center\",\n    objectFit: cssObjectFit(image.fit),\n    imageRendering: cssImageRendering(image, containerSize)\n  };\n}\n\nconst InnerImage = _ref => {\n  let {\n    image,\n    containerSize,\n    nodeId,\n    alt\n  } = _ref;\n  const wrapperRef = React.useRef(null); // These variables should never change for the lifetime of the component so it's fine to conditionally use hooks\n\n  const isStaticRendering = RenderTarget.current() !== RenderTarget.canvas;\n  const source = runtime.useImageSource(image, containerSize, nodeId); // srcSet doesn't need resolving via useImageSource, since these are\n  // currently only used in generated components, where resolution happens\n  // during code-generation.\n\n  const srcSet = image.srcSet;\n  const imageStyle = getImageStyle(image, containerSize);\n\n  if (!isStaticRendering) {\n    const imageElement = runtime.useImageElement(image, containerSize, nodeId); // eslint-disable-next-line react-hooks/rules-of-hooks\n\n    useIsomorphicLayoutEffect(() => {\n      const wrapper = wrapperRef.current;\n      if (wrapper === null) return;\n      wrapper.appendChild(imageElement);\n      return () => {\n        wrapper.removeChild(imageElement);\n      };\n    }, [imageElement]);\n    Object.assign(imageElement.style, imageStyle);\n  }\n\n  return React.createElement(\"div\", {\n    ref: wrapperRef,\n    style: {\n      display: \"contents\",\n      borderRadius: \"inherit\",\n      pointerEvents: \"none\"\n    }\n  }, isStaticRendering ? React.createElement(\"img\", {\n    src: source,\n    alt: alt ?? image.alt,\n    srcSet: srcSet,\n    sizes: image.sizes,\n    style: imageStyle\n  }) : null);\n};\n\nexport function BackgroundImageComponent(_ref2) {\n  let {\n    layoutId,\n    ...rest\n  } = _ref2;\n\n  if (layoutId) {\n    layoutId = layoutId + \"-background\";\n  }\n\n  return React.createElement(motion.div, {\n    style: wrapperStyle,\n    layoutId: layoutId\n  }, React.createElement(InnerImage, { ...rest\n  }));\n}","map":{"version":3,"mappings":"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","names":["React","motion","runtime","safeWindow","imageRenderingForZoom","minZoomForPixelatedImageRendering","useIsomorphicLayoutEffect","RenderEnvironment","RenderTarget","wrapperStyle","position","pointerEvents","userSelect","borderRadius","top","right","bottom","left","cssObjectFit","imageFit","cssImageRendering","image","containerSize","devicePixelRatio","current","canvas","minPixelatedZoom","zoom","getImageStyle","display","width","height","objectPosition","objectFit","fit","imageRendering","InnerImage","nodeId","alt","wrapperRef","useRef","isStaticRendering","source","useImageSource","srcSet","imageStyle","imageElement","useImageElement","wrapper","appendChild","removeChild","Object","assign","style","ref","src","sizes","BackgroundImageComponent","layoutId","rest","div"],"sources":["../../../src/render/style/BackgroundImageComponent.tsx"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}